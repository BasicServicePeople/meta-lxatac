From: =?UTF-8?q?Leonard=20G=C3=B6hrs?= <l.goehrs@pengutronix.de>
Date: Tue, 25 Oct 2022 10:48:17 +0200
Subject: [PATCH] ARM: dts: stm32: lxa-tac: add regulators on power board and
 attach ADC
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

The newly added voltages are isolated from the voltages on the main board.

Signed-off-by: Leonard GÃ¶hrs <l.goehrs@pengutronix.de>
---
 arch/arm/boot/dts/stm32mp157c-lxa-tac.dts | 22 +++++++++++++++++++++-
 1 file changed, 21 insertions(+), 1 deletion(-)

diff --git a/arch/arm/boot/dts/stm32mp157c-lxa-tac.dts b/arch/arm/boot/dts/stm32mp157c-lxa-tac.dts
index 01dc2a768e7a..0e43ce6ec8e1 100644
--- a/arch/arm/boot/dts/stm32mp157c-lxa-tac.dts
+++ b/arch/arm/boot/dts/stm32mp157c-lxa-tac.dts
@@ -117,6 +117,24 @@ reg_1v2: regulator_1v2 {
 		vin-supply = <&reg_5v>;
 	};
 
+	reg_pb_5v: regulator_pb_5v {
+		compatible = "regulator-fixed";
+		regulator-name = "5V_POWERBOARD";
+		regulator-min-microvolt = <5000000>;
+		regulator-max-microvolt = <5000000>;
+		regulator-always-on;
+		vin-supply = <&reg_5v>;
+	};
+
+	reg_pb_3v3: regulator_pb_3v3 {
+		compatible = "regulator-fixed";
+		regulator-name = "3V3_POWERBOARD";
+		regulator-min-microvolt = <3300000>;
+		regulator-max-microvolt = <3300000>;
+		regulator-always-on;
+		vin-supply = <&reg_pb_5v>;
+	};
+
 	iobus_curr: current-sense-amplifier-0 {
 		compatible = "current-sense-amplifier";
 		io-channels = <&adc1 5>;
@@ -466,8 +484,10 @@ lmp92064@0 {
 		compatible = "ti,lmp92064";
 		reg = <0>;
 		spi-max-frequency = <5000000>;
+		vdd-supply = <&reg_pb_3v3>;
+		vdig-supply = <&reg_pb_3v3>;
 		reset-gpios = <&powerboard_gpio 2 GPIO_ACTIVE_HIGH>;
-		shunt-resistor = <15000>;
+		shunt-resistor-micro-ohms = <15000>;
 	};
 };
 
